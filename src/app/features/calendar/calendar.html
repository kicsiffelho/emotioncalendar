<div class="calendar">
  <div class="calendar-header">
    <button class="nav-button" (click)="previousMonth()">Previous</button>
    <h2>{{ currentMonth() | date:'MMMM yyyy' }}</h2>
    <button class="nav-button" (click)="nextMonth()">Next</button>
  </div>

  <div class="weekdays">
    <div class="weekday">Sun</div>
    <div class="weekday">Mon</div>
    <div class="weekday">Tue</div>
    <div class="weekday">Wed</div>
    <div class="weekday">Thu</div>
    <div class="weekday">Fri</div>
    <div class="weekday">Sat</div>
  </div>

  <div class="days-grid">
    <div 
      *ngFor="let day of calendarDays()" 
      class="day"
      [class.other-month]="!day.isCurrentMonth"
      [class.has-emotion]="day.emotion"
      [class.emotion-happy]="day.emotion?.mood === 'happy'"
      [class.emotion-neutral]="day.emotion?.mood === 'neutral'"
      [class.emotion-sad]="day.emotion?.mood === 'sad'"
      [class.emotion-angry]="day.emotion?.mood === 'angry'"
      [class.emotion-anxious]="day.emotion?.mood === 'anxious'"
      (click)="selectDay(day)"
      (mouseenter)="showTooltip(day, $event)"
      (mouseleave)="hideTooltip()">
      
      <div class="day-number">{{ day.date.getDate() }}</div>
      
      <div *ngIf="day.emotion" class="emotion-indicator"></div>
    </div>
  </div>

  <div *ngIf="loading()" class="loading">Loading emotions...</div>

  <div 
    *ngIf="selectedDay() && selectedDay()!.emotion && showTooltipFlag()" 
    class="emotion-details"
    [style.top]="tooltipPosition().top + 'px'"
    [style.left]="tooltipPosition().left + 'px'">
    <strong>{{ selectedDay()!.emotion!.mood | titlecase }}</strong>
    <div *ngIf="selectedDay()!.emotion!.notes">
      {{ selectedDay()!.emotion!.notes }}
    </div>
    <small>Click to edit</small>
  </div>
</div>